(window.webpackJsonp=window.webpackJsonp||[]).push([[19],{571:function(s,t,a){"use strict";a.r(t);var e=a(13),r=Object(e.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h2",{attrs:{id:"序言"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#序言"}},[s._v("#")]),s._v(" 序言")]),s._v(" "),a("p",[s._v("webpack的热更新我一直都在用，但是很少深入去了解它的具体原理。最近看到极客时间的webpack课程，正好有机会深入解析一下webpack的热更新。")]),s._v(" "),a("h2",{attrs:{id:"热更新和文件监听"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#热更新和文件监听"}},[s._v("#")]),s._v(" 热更新和文件监听")]),s._v(" "),a("p",[s._v("借助webpack-dev-server，当代码有修改时自动构建，构建完成后通过热更新让浏览器去变化，省去了自己刷新浏览器的步骤。")]),s._v(" "),a("p",[s._v("热更新需要借助"),a("code",[s._v("webpack-dev-server")]),s._v(" 和 "),a("code",[s._v("HotModuleReplacementPlugin")]),s._v("来完成")]),s._v(" "),a("p",[s._v("输出文件在内存中，没有磁盘IO，所以构建速度更快一点")]),s._v(" "),a("p",[s._v("与之形成对比的是文件监听，也就是 "),a("code",[s._v("webpack --watch")]),s._v("，它输出的文件放在磁盘中。这里顺便说一下监听的原理：")]),s._v(" "),a("blockquote",[a("p",[s._v("轮询去判断文件的最后编辑时间是否发生了变化，当发生变化时，先缓存起来，等待一段时间（aggregateTimeout），在这个时间段内的所有变化文件拿去构建，一起把构建的结果生成到bundle中")])]),s._v(" "),a("h2",{attrs:{id:"基本用法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#基本用法"}},[s._v("#")]),s._v(" 基本用法")]),s._v(" "),a("ol",[a("li",[s._v("在package.json 中 添加命令")])]),s._v(" "),a("div",{staticClass:"language-json line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"scripts"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"dev"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"webpack-dev-server --open"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// open 参数每次构建完成自动开启浏览器")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("ol",{attrs:{start:"2"}},[a("li",[a("p",[s._v("创建webpack development config")])]),s._v(" "),a("li",[a("p",[s._v("配置插件，这个插件是webpack内置的，所以不需要引用")])])]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("plugins")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("webpack"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("HotModuleReplacementPlugin")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("ol",{attrs:{start:"4"}},[a("li",[s._v("配置热更新")])]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("devServer")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("contentBase")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'./dist'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 服务的基础目录")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("hot")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 开启热更新")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("h2",{attrs:{id:"原理分析"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#原理分析"}},[s._v("#")]),s._v(" 原理分析")]),s._v(" "),a("p",[s._v("首先来看看webpack的几个基本概念：")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("Webpack Compile： 将 JS 源代码编译成 bundle.js")])]),s._v(" "),a("li",[a("p",[s._v("HMR Server: 用来将热更新的文件输出给 HMR Runtime")])]),s._v(" "),a("li",[a("p",[s._v("Bundle Server： 提供文件在浏览器的访问，以服务的方式访问")])]),s._v(" "),a("li",[a("p",[s._v("HMR Runtime：会被注入到浏览器，更新文件的变化")])]),s._v(" "),a("li",[a("p",[s._v("bundle.js 构建好输出的文件")])])]),s._v(" "),a("p",[s._v("HMR Runtime 和 HMR Server 会建立起一条链接，通常是websocket，就可以实时更新文件的变化。")]),s._v(" "),a("p",[a("a",{attrs:{href:"https://juejin.cn/post/6844904008432222215",target:"_blank",rel:"noopener noreferrer"}},[s._v("轻松理解webpack热更新原理"),a("OutboundLink")],1)])])}),[],!1,null,null,null);t.default=r.exports}}]);